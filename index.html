<!doctype html>
<html>
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"> 
  <title>è½ç¾½SVIPå¼±ç½‘</title> 
  <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: #f5f7fa; 
            min-height: 100vh; 
            color: #2d3748; 
            font-size: 14px; 
            overflow-x: hidden;
        }
        .header { 
            background: linear-gradient(135deg, #4299e1 0%, #38b2ac 100%); 
            color: #fff; 
            padding: 16px 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            position: sticky; 
            top: 0; 
            z-index: 100;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        .header h1 { font-size: 20px; font-weight: 600; }
        .header button { 
            color: #fff; 
            background: rgba(255,255,255,0.2); 
            border: 1px solid rgba(255,255,255,0.3); 
            padding: 8px 16px; 
            font-size: 14px; 
            border-radius: 20px; 
            cursor: pointer;
            transition: all 0.2s;
        }
        .header button:hover { background: rgba(255,255,255,0.3); }
        /* é¡µé¢å®¹å™¨ - æ ¸å¿ƒä¿®å¤ï¼šè§£å†³å±‚çº§å’ŒåŠ¨ç”»å¡é¡¿ */
        .page-container {
            position: relative;
            width: 100%;
            overflow: hidden;
            min-height: calc(100vh - 120px);
            z-index: 1;
        }
        /* é¡µé¢åˆ‡æ¢åŠ¨ç”» - ç®€åŒ–åŠ¨ç”»ï¼Œé¿å…å¡é¡¿å¯¼è‡´æ— å“åº” */
        .page { 
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            min-height: calc(100vh - 60px);
            padding-bottom: 80px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 1;
        }
        .page.active { 
            position: relative;
            opacity: 1;
            visibility: visible;
            z-index: 2;
        }
        /* å·¥ä½œå°æ ·å¼ */
        .app-selector { 
            background: #fff; 
            padding: 20px; 
            display: flex; 
            align-items: center; 
            border-radius: 12px;
            margin: 16px 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            z-index: 10;
            position: relative;
        }
        .app-icon { 
            width: 56px; 
            height: 56px; 
            border-radius: 12px; 
            background: #e8f4f8; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            margin-right: 16px; 
            overflow: hidden;
            flex-shrink: 0;
        }
        .app-icon img { width: 38px; height: 38px; object-fit: contain; }
        .app-icon-placeholder { 
            width: 38px; 
            height: 38px; 
            background: linear-gradient(135deg, #4299e1 0%, #38b2ac 100%); 
            border-radius: 8px; 
        }
        .app-info { flex: 1; padding-right: 12px; }
        .app-name { font-size: 17px; font-weight: 600; color: #2d3748; }
        .app-hint { font-size: 12px; color: #718096; margin-top: 4px; }
        .btn-start { 
            background: linear-gradient(135deg, #4299e1 0%, #38b2ac 100%); 
            color: #fff; 
            border: none; 
            padding: 10px 28px; 
            border-radius: 25px; 
            font-size: 14px; 
            font-weight: 500; 
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(66,153,225,0.3);
            flex-shrink: 0;
        }
        .btn-start.running { 
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
        }
        /* é©±åŠ¨æµ‹è¯•å¡ç‰‡ */
        .driver-test-card {
            background: #fff; 
            margin: 16px 12px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            padding: 20px;
        }
        .driver-test-title {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
        }
        .driver-test-title i {
            display: inline-block;
            width: 4px;
            height: 18px;
            background: #4299e1;
            margin-right: 8px;
            border-radius: 2px;
        }
        .driver-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8fafc;
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 16px;
        }
        .driver-status-info {
            flex: 1;
        }
        .driver-status-label {
            font-size: 14px;
            color: #4a5568;
            margin-bottom: 4px;
        }
        .driver-status-value {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
        }
        .driver-status-value.ready { color: #38a169; }
        .driver-status-value.unready { color: #e53e3e; }
        .driver-btn-group {
            display: flex;
            gap: 12px;
        }
        .driver-btn {
            flex: 1;
            padding: 12px 0;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        .driver-btn.primary {
            background: #4299e1;
            color: #fff;
        }
        .driver-btn.secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        .driver-log-box {
            background: #1a202c;
            color: #a0aec0;
            font-family: monospace;
            font-size: 12px;
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
            max-height: 200px;
            overflow-y: auto;
            line-height: 1.6;
        }
        .driver-log-item {
            padding: 4px 0;
            border-bottom: 1px solid #2d3748;
            color: #cbd5e0;
        }
        .driver-log-item.success { color: #68d391; }
        .driver-log-item.error { color: #fc8181; }
        .scene-list { 
            background: #fff; 
            margin: 0 12px 16px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }
        .scene-item { 
            padding: 18px 20px; 
            border-bottom: 1px solid #f7fafc; 
            display: flex; 
            align-items: center; 
            cursor: pointer;
            transition: background 0.2s;
        }
        .scene-item:hover { background: #f8fafc; }
        .scene-item:last-child { border-bottom: none; }
        .scene-item.selected { 
            background: #e8f4f8;
            border-left: 4px solid #4299e1;
        }
        .scene-content { flex: 1; }
        .scene-name { font-size: 16px; font-weight: 500; }
        .scene-desc { font-size: 12px; color: #718096; margin-top: 4px; }
        .scene-arrow { color: #cbd5e0; font-size: 20px; flex-shrink: 0; }
        /* è®¾ç½®é¡µé¢æ ·å¼ */
        .settings-section { 
            background: #fff; 
            margin: 16px 12px; 
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }
        .settings-title { 
            font-size: 15px; 
            padding: 16px 20px; 
            background: #f8f9fa; 
            font-weight: 600;
            border-bottom: 1px solid #f0f2f5;
        }
        .option-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 16px 20px; 
            border-bottom: 1px solid #f7fafc; 
        }
        .option-item:last-child { border-bottom: none; }
        .option-label { font-size: 15px; font-weight: 500; }
        .option-desc { font-size: 12px; color: #718096; margin-top: 2px; }
        .switch { position: relative; width: 54px; height: 30px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { 
            position: absolute; 
            cursor: pointer; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background-color: #e2e8f0; 
            transition: .3s; 
            border-radius: 30px;
        }
        .slider:before { 
            position: absolute; 
            content: ""; 
            height: 24px; 
            width: 24px; 
            left: 3px; 
            bottom: 3px; 
            background-color: white; 
            transition: .3s; 
            border-radius: 50%;
        }
        input:checked + .slider { background-color: #4299e1; }
        input:checked + .slider:before { transform: translateX(24px); }
        .pcap-path-box { 
            background: #f5fafe; 
            padding: 12px 16px; 
            margin: 8px 20px 16px; 
            font-size: 12px; 
            color: #4a5568; 
            word-break: break-all;
            border: 1px solid #e8f4f8;
        }
        .info-item { 
            padding: 16px 20px; 
            border-bottom: 1px solid #f7fafc; 
        }
        .info-item:last-child { border-bottom: none; }
        .info-label { font-size: 13px; color: #718096; }
        .info-value { font-size: 15px; margin-top: 4px; font-weight: 500; }
        /* æç¤ºå¼¹çª— */
        .status-toast { 
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            background: rgba(0,0,0,0.8); 
            color: #fff; 
            padding: 14px 28px; 
            border-radius: 8px; 
            font-size: 14px; 
            display: none; 
            z-index: 200;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .status-toast.show { display: block; }
        /* åº•éƒ¨å¯¼èˆª */
        .bottom-nav { 
            background: #fff; 
            border-top: 1px solid #e2e8f0; 
            display: flex; 
            padding: 10px 0; 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            right: 0; 
            z-index: 9999;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        .nav-item { 
            flex: 1; 
            text-align: center; 
            padding: 6px; 
            cursor: pointer;
            border-radius: 8px;
            margin: 0 4px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            transition: background 0.2s;
        }
        .nav-item.active {
            background: #e8f4f8;
        }
        .nav-item.active .nav-icon, .nav-item.active .nav-text { 
            color: #4299e1; 
        }
        .nav-icon { 
            font-size: 22px; 
            color: #a0aec0; 
            margin-bottom: 4px; 
        }
        .nav-text { 
            font-size: 12px; 
            color: #a0aec0; 
            font-weight: 500;
        }
        /* å‚æ•°é…ç½®é¡µé¢æ ·å¼ */
        .config-page {
            padding: 16px 12px;
        }
        .scene-info-card { 
            background: linear-gradient(135deg, #e8f4f8 0%, #f0f8fb 100%); 
            padding: 20px; 
            border-radius: 12px; 
            margin-bottom: 16px;
            border: 1px solid #dee2e6;
            position: relative;
        }
        .scene-info-tag {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #4299e1;
            color: #fff;
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 4px;
        }
        .scene-info-name { 
            font-size: 18px; 
            font-weight: 600; 
            color: #2c5282;
            margin-bottom: 6px;
        }
        .scene-info-desc { 
            font-size: 13px; 
            color: #4a5568; 
            line-height: 1.5;
        }
        .param-card {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 16px;
            border: 1px solid #e2e8f0;
        }
        .param-group-title {
            font-size: 15px;
            font-weight: 600;
            color: #2d3748;
            margin: 0 0 16px 0;
            padding-bottom: 8px;
            border-bottom: 1px solid #f0f2f5;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .param-group-title i {
            color: #4299e1;
            font-style: normal;
        }
        .param-row { 
            display: flex; 
            gap: 16px; 
            margin: 0 0 20px 0;
            align-items: stretch;
            width: 100%;
        }
        .param-group { 
            flex: 1;
            position: relative;
            display: flex;
            flex-direction: column;
            min-height: 90px;
        }
        .param-label { 
            font-size: 13px; 
            color: #4a5568; 
            margin: 0 0 8px 0; 
            font-weight: 500;
        }
        .param-input { 
            width: 100%; 
            padding: 12px 16px; 
            border: 1px solid #e2e8f0; 
            border-radius: 8px; 
            font-size: 15px;
            transition: all 0.2s ease;
            background: #fafbfc;
            height: 44px;
        }
        .param-input:focus { 
            border-color: #4299e1; 
            outline: none;
            box-shadow: 0 0 0 3px rgba(66,153,225,0.1);
        }
        .param-tip {
            font-size: 11px;
            color: #9aa2b1;
            margin: 4px 0 0 0;
        }
        .btn-group {
            display: flex;
            gap: 12px;
            margin: 12px 0 0 0;
            padding-top: 16px;
            border-top: 1px dashed #e2e8f0;
        }
        .confirm-btn, .reset-btn {
            flex: 1;
            padding: 14px 0;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            height: 52px;
            transition: all 0.2s;
        }
        .confirm-btn {
            background: linear-gradient(135deg, #4299e1 0%, #38b2ac 100%); 
            color: #fff;
        }
        .confirm-btn:hover { opacity: 0.9; }
        .reset-btn {
            background: #f5f7fa;
            color: #4a5568;
            border: 1px solid #e2e8f0;
        }
        .reset-btn:hover { background: #edf2f7; }
        .protocol-select, .cycle-type-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23718096' viewBox='0 0 16 16'%3E%3Cpath d='M8 11l4-4H4l4 4z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 36px !important;
            height: 44px;
        }
        .cycle-title {
            font-size: 14px;
            color: #2c5282;
            margin: 0 0 16px 0;
            padding-left: 4px;
            font-weight: 500;
        }
  </style> 
 </head> 
 <body> 
  <div class="header"> 
   <div style="width:50px;"></div> 
   <h1 id="pageTitle">è½ç¾½SVIPå¼±ç½‘</h1> 
   <button onclick="goBack()">è¿”å›</button> 
  </div> 

  <!-- é¡µé¢å®¹å™¨ -->
  <div class="page-container">
    <!-- å·¥ä½œå°é¡µé¢ -->
    <div class="page active" id="pageWorkbench"> 
     <div class="page-content"> 
      <div class="app-selector"> 
       <div class="app-icon"> 
        <img id="appIconImg" src="" style="display:none;"> 
        <div id="appIconPlaceholder" class="app-icon-placeholder"></div> 
       </div> 
       <div class="app-info"> 
        <div id="appName" class="app-name">æ— éœ€é€‰æ‹©åº”ç”¨</div> 
        <div id="appHint" class="app-hint">è¯·ç›´æ¥å¯åŠ¨</div> 
       </div> 
       <button class="btn-start" id="btnStart" onclick="toggleVPN()">å¯åŠ¨</button> 
      </div> 
      
      <!-- é©±åŠ¨æµ‹è¯•å¡ç‰‡ - å®Œæ•´ä¿®å¤ -->
      <div class="driver-test-card">
        <div class="driver-test-title">
          <i></i>é©±åŠ¨æµ‹è¯•ä¸è¯Šæ–­
        </div>
        <div class="driver-status">
          <div class="driver-status-info">
            <div class="driver-status-label">é©±åŠ¨çŠ¶æ€</div>
            <div class="driver-status-value" id="driverStatusText">æœªæ£€æµ‹</div>
          </div>
          <div class="driver-btn-group">
            <button class="driver-btn primary" onclick="testDriver()">æµ‹è¯•é©±åŠ¨</button>
            <button class="driver-btn secondary" onclick="installDriver()">å®‰è£…é©±åŠ¨</button>
          </div>
        </div>
        <div style="display: flex; gap: 12px; margin-bottom: 16px;">
          <button class="driver-btn secondary" onclick="checkVpnPermission()" style="flex: 1;">VPNæƒé™æ£€æµ‹</button>
          <button class="driver-btn secondary" onclick="checkNetworkStack()" style="flex: 1;">ç½‘ç»œæ ˆæ£€æµ‹</button>
          <button class="driver-btn secondary" onclick="clearDriverLog()" style="flex: 0.5;">æ¸…ç©º</button>
        </div>
        <div class="driver-log-box" id="driverLogBox">
          <div class="driver-log-item">ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼Œç­‰å¾…é©±åŠ¨æ£€æµ‹...</div>
        </div>
      </div>

      <div class="scene-list" id="sceneList"> 
       <div class="scene-item selected" data-scene="normal" onclick="gotoConfigPage(this)">
        <div class="scene-content">
         <div class="scene-name">æ­£å¸¸ç½‘ç»œ</div>
         <div class="scene-desc">æœªè®¾ç½®ä»»ä½•å¼±ç½‘å‚æ•°çš„æ­£å¸¸ç½‘ç»œ</div>
        </div>
        <div class="scene-arrow">&gt;</div>
       </div> 
       <div class="scene-item" data-scene="continuous_loss" onclick="gotoConfigPage(this)">
        <div class="scene-content">
         <div class="scene-name">è¿ç»­ä¸¢åŒ…</div>
         <div class="scene-desc">æ¨¡æ‹ŸçŸ­æ—¶é—´å†…è¿ç»­ä¸¢åŒ…çš„ç½‘ç»œåœºæ™¯</div>
        </div>
        <div class="scene-arrow">&gt;</div>
       </div> 
       <div class="scene-item" data-scene="total_loss" onclick="gotoConfigPage(this)">
        <div class="scene-content">
         <div class="scene-name">100%ä¸¢åŒ…</div>
         <div class="scene-desc">ä¸Šä¸‹è¡Œ100%ä¸¢åŒ…çš„å¼±ç½‘åœºæ™¯</div>
        </div>
        <div class="scene-arrow">&gt;</div>
       </div> 
       <div class="scene-item" data-scene="poor_network" onclick="gotoConfigPage(this)">
        <div class="scene-content">
         <div class="scene-name">æå·®ç½‘ç»œ</div>
         <div class="scene-desc">ä½å¸¦å®½ï¼Œé«˜å»¶è¿Ÿï¼Œé«˜æ¦‚ç‡éšæœºä¸¢åŒ…</div>
        </div>
        <div class="scene-arrow">&gt;</div>
       </div> 
       <div class="scene-item" data-scene="4g" onclick="gotoConfigPage(this)">
        <div class="scene-content">
         <div class="scene-name">4Gç½‘ç»œ</div>
         <div class="scene-desc">æ¨¡æ‹Ÿ4Gç§»åŠ¨ç½‘ç»œç¯å¢ƒ</div>
        </div>
        <div class="scene-arrow">&gt;</div>
       </div> 
       <div class="scene-item" data-scene="3g" onclick="gotoConfigPage(this)">
        <div class="scene-content">
         <div class="scene-name">3Gç½‘ç»œ</div>
         <div class="scene-desc">æ¨¡æ‹Ÿ3Gç§»åŠ¨ç½‘ç»œç¯å¢ƒ</div>
        </div>
        <div class="scene-arrow">&gt;</div>
       </div> 
       <div class="scene-item" data-scene="2g" onclick="gotoConfigPage(this)">
        <div class="scene-content">
         <div class="scene-name">2Gç½‘ç»œ</div>
         <div class="scene-desc">æ¨¡æ‹Ÿ2Gç§»åŠ¨ç½‘ç»œç¯å¢ƒ</div>
        </div>
        <div class="scene-arrow">&gt;</div>
       </div>
      </div> 
     </div> 
    </div> 

    <!-- è®¾ç½®é¡µé¢ -->
    <div class="page" id="pageSettings"> 
     <div class="page-content"> 
      <div class="settings-section"> 
       <div class="settings-title">æ‚¬æµ®çª—è®¾ç½®</div> 
       <div class="option-item"> 
        <div>
         <div class="option-label">æ§åˆ¶æ‚¬æµ®çª—</div>
         <div class="option-desc">æ˜¾ç¤ºå¿«æ·æ§åˆ¶æŒ‰é’®</div>
        </div> 
        <label class="switch"><input type="checkbox" id="controlFw" onchange="saveOptions()" checked><span class="slider"></span></label> 
       </div> 
       <div class="option-item"> 
        <div>
         <div class="option-label">ä¿¡æ¯æ‚¬æµ®çª—</div>
         <div class="option-desc">æ˜¾ç¤ºå®æ—¶ç½‘ç»œä¿¡æ¯</div>
        </div> 
        <label class="switch"><input type="checkbox" id="infoFw" onchange="saveOptions()"><span class="slider"></span></label> 
       </div> 
      </div> 

      <div class="settings-section"> 
       <div class="settings-title">é˜²å°è®¾ç½®</div> 
       <div class="option-item"> 
        <div>
         <div class="option-label">é˜²å°æ¨¡å¼</div>
         <div class="option-desc">å¿…é¡»å¼€å¯</div>
        </div> 
        <label class="switch"><input type="checkbox" id="antiBlock" onchange="saveOptions()" checked><span class="slider"></span></label> 
       </div> 
      </div>

      <div class="settings-section"> 
       <div class="settings-title">æŠ“åŒ…è®¾ç½®</div> 
       <div class="option-item"> 
        <div>
         <div class="option-label">æŠ“åŒ…ä¿å­˜</div>
         <div class="option-desc">ä¿å­˜ç½‘ç»œæ•°æ®åŒ…åˆ°æœ¬åœ°</div>
        </div> 
        <label class="switch"><input type="checkbox" id="dumpPcap" onchange="saveOptions()"><span class="slider"></span></label> 
       </div> 
       <div id="pcapPathSection" style="display: none;"> 
        <div class="pcap-path-box" id="pcapPath">-</div> 
       </div> 
      </div> 

      <div class="settings-section"> 
       <div class="settings-title">é©±åŠ¨ç®¡ç†</div> 
       <div class="option-item"> 
        <div>
         <div class="option-label">é©±åŠ¨ç‰ˆæœ¬</div>
         <div class="option-desc" id="driverVersion">v2.1.5 (æœªåŠ è½½)</div>
        </div> 
        <button onclick="checkDriverUpdate()" style="padding: 8px 16px; background: #4299e1; color: #fff; border: none; border-radius: 6px; cursor: pointer;">æ£€æŸ¥æ›´æ–°</button>
       </div> 
      </div>

      <div class="settings-section"> 
       <div class="settings-title">å…³äºåº”ç”¨</div> 
       <div class="info-item">
        <div class="info-label">åº”ç”¨ç‰ˆæœ¬</div>
        <div class="info-value" id="appVersion">2.1.5</div>
       </div> 
       <div class="info-item">
        <div class="info-label">è½ç¾½å®˜æ–¹QQ</div>
        <div class="info-value" style="color:#4299e1;font-weight:600;">2357686280</div>
       </div>
       <div class="info-item">
        <div class="info-label">ä½œè€…</div>
        <div class="info-value">è½ç¾½</div>
       </div> 
      </div> 
     </div> 
    </div> 

    <!-- å‚æ•°é…ç½®é¡µé¢ -->
    <div class="page" id="pageConfig">
      <div class="page-content config-page">
          <div class="scene-info-card"> 
              <div class="scene-info-tag">å½“å‰åœºæ™¯</div>
              <div class="scene-info-name" id="configSceneName">-</div> 
              <div class="scene-info-desc" id="configSceneDesc">-</div> 
          </div>

          <div class="param-card">
              <div class="param-group-title"><i></i>å»¶è¿Ÿä¸æŠ–åŠ¨è®¾ç½®</div>
              <div class="param-row"> 
                  <div class="param-group">
                      <label class="param-label">ä¸Šè¡Œå»¶è¿Ÿ</label>
                      <input type="number" class="param-input" id="outDelay" value="0" min="0" max="10000">
                      <span class="param-tip">èŒƒå›´ï¼š0-10000ms</span>
                  </div> 
                  <div class="param-group">
                      <label class="param-label">ä¸‹è¡Œå»¶è¿Ÿ</label>
                      <input type="number" class="param-input" id="inDelay" value="0" min="0" max="10000">
                      <span class="param-tip">èŒƒå›´ï¼š0-10000ms</span>
                  </div> 
              </div> 
              <div class="param-row"> 
                  <div class="param-group">
                      <label class="param-label">ä¸Šè¡Œå»¶æ—¶æŠ–åŠ¨</label>
                      <input type="number" class="param-input" id="outJitter" value="0" min="0" max="5000">
                      <span class="param-tip">èŒƒå›´ï¼š0-5000ms</span>
                  </div> 
                  <div class="param-group">
                      <label class="param-label">ä¸‹è¡Œå»¶æ—¶æŠ–åŠ¨</label>
                      <input type="number" class="param-input" id="inJitter" value="0" min="0" max="5000">
                      <span class="param-tip">èŒƒå›´ï¼š0-5000ms</span>
                  </div> 
              </div> 

              <div class="param-group-title"><i></i>ä¸¢åŒ…ä¸å¸¦å®½è®¾ç½®</div>
              <div class="param-row"> 
                  <div class="param-group">
                      <label class="param-label">ä¸Šè¡Œä¸¢åŒ…ç‡</label>
                      <input type="number" class="param-input" id="outLoss" value="0" min="0" max="100">
                      <span class="param-tip">èŒƒå›´ï¼š0-100%</span>
                  </div> 
                  <div class="param-group">
                      <label class="param-label">ä¸‹è¡Œä¸¢åŒ…ç‡</label>
                      <input type="number" class="param-input" id="inLoss" value="0" min="0" max="100">
                      <span class="param-tip">èŒƒå›´ï¼š0-100%</span>
                  </div> 
              </div> 
              <div class="param-row"> 
                  <div class="param-group">
                      <label class="param-label">ä¸Šè¡Œå¸¦å®½</label>
                      <input type="number" class="param-input" id="outBandwidth" value="0" min="0">
                      <span class="param-tip">0ä¸ºä¸é™é€Ÿï¼Œå•ä½KB/s</span>
                  </div> 
                  <div class="param-group">
                      <label class="param-label">ä¸‹è¡Œå¸¦å®½</label>
                      <input type="number" class="param-input" id="inBandwidth" value="0" min="0">
                      <span class="param-tip">0ä¸ºä¸é™é€Ÿï¼Œå•ä½KB/s</span>
                  </div> 
              </div> 

              <div class="param-group-title"><i></i>å‘¨æœŸå¼±ç½‘è®¾ç½®</div>
              <div class="cycle-title">â–¶ ä¸Šè¡Œå‘¨æœŸå¼±ç½‘</div>
              <div class="param-row">
                  <div class="param-group">
                      <label class="param-label">å¼±ç½‘ç±»å‹</label>
                      <select class="param-input cycle-type-select" id="outCycleType">
                          <option value="full">å®Œå…¨å¼±ç½‘</option>
                          <option value="burst">Burstçªå‘å¼±ç½‘</option>
                      </select>
                      <span class="param-tip">å®Œå…¨å¼±ç½‘=å‘¨æœŸå†…æŒç»­å¼±ç½‘ï¼›Burst=å‘¨æœŸå†…çªå‘å¼å¼±ç½‘</span>
                  </div>
                  <div class="param-group">
                      <label class="param-label">å‘¨æœŸæ—¶é•¿</label>
                      <input type="number" class="param-input" id="outCycleTime" value="0" min="0" max="30000">
                      <span class="param-tip">å•æ¬¡å¾ªç¯æ€»æ—¶é•¿ï¼Œ0ä¸ºå…³é—­ï¼Œå•ä½ms</span>
                  </div>
              </div>
              <div class="param-row">
                  <div class="param-group">
                      <label class="param-label">å‘¨æœŸä¸¢åŒ…ç‡</label>
                      <input type="number" class="param-input" id="outCycleLoss" value="0" min="0" max="100">
                      <span class="param-tip">å‘¨æœŸå†…ä¸¢åŒ…ç‡ï¼Œ%</span>
                  </div>
              </div>

              <div class="cycle-title">â–¶ ä¸‹è¡Œå‘¨æœŸå¼±ç½‘</div>
              <div class="param-row">
                  <div class="param-group">
                      <label class="param-label">å¼±ç½‘ç±»å‹</label>
                      <select class="param-input cycle-type-select" id="inCycleType">
                          <option value="full">å®Œå…¨å¼±ç½‘</option>
                          <option value="burst">Burstçªå‘å¼å¼±ç½‘</option>
                      </select>
                      <span class="param-tip">å®Œå…¨å¼±ç½‘=å‘¨æœŸå†…æŒç»­å¼±ç½‘ï¼›Burst=å‘¨æœŸå†…çªå‘å¼å¼±ç½‘</span>
                  </div>
                  <div class="param-group">
                      <label class="param-label">å‘¨æœŸæ—¶é•¿</label>
                      <input type="number" class="param-input" id="inCycleTime" value="0" min="0" max="30000">
                      <span class="param-tip">å•æ¬¡å¾ªç¯æ€»æ—¶é•¿ï¼Œ0ä¸ºå…³é—­ï¼Œå•ä½ms</span>
                  </div>
              </div>
              <div class="param-row">
                  <div class="param-group">
                      <label class="param-label">å‘¨æœŸä¸¢åŒ…ç‡</label>
                      <input type="number" class="param-input" id="inCycleLoss" value="0" min="0" max="100">
                      <span class="param-tip">å‘¨æœŸå†…ä¸¢åŒ…ç‡ï¼Œ%</span>
                  </div>
              </div>

              <div class="param-group-title"><i></i>åè®®è®¾ç½®</div>
              <div class="param-row-full"> 
                  <div class="param-group">
                      <label class="param-label">åè®®ç±»å‹</label>
                      <select class="param-input protocol-select" id="protocolType"> 
                          <option value="3">TCP + UDP</option> 
                          <option value="1">ä»… TCP</option> 
                          <option value="2">ä»… UDP</option> 
                          <option value="4">ä»… DNS</option> 
                          <option value="8">ä»… ICMP</option> 
                          <option value="5">TCP + DNS</option> 
                          <option value="6">UDP + DNS</option> 
                          <option value="7">TCP + UDP + DNS</option> 
                          <option value="15">å…¨éƒ¨ (TCP+UDP+DNS+ICMP)</option> 
                      </select>
                      <span class="param-tip">é€‰æ‹©éœ€è¦é™åˆ¶çš„ç½‘ç»œåè®®</span>
                  </div> 
              </div>

              <div class="btn-group">
                  <button class="reset-btn" onclick="resetConfig()">é‡ç½®é»˜è®¤</button>
                  <button class="confirm-btn" onclick="confirmConfig()">ç¡®è®¤é…ç½®</button>
              </div>
          </div>
      </div>
    </div>
  </div>

  <div class="bottom-nav"> 
   <div class="nav-item active" id="navWorkbench" onclick="switchPage('workbench')">
    <div class="nav-icon">âš™ï¸</div>
    <div class="nav-text">å·¥ä½œå°</div>
   </div> 
   <div class="nav-item" id="navConfig" onclick="gotoConfigPageByNav()">
    <div class="nav-icon">ğŸ“</div>
    <div class="nav-text">å‚æ•°é…ç½®</div>
   </div>
   <div class="nav-item" id="navSettings" onclick="switchPage('settings')">
    <div class="nav-icon">âš™ï¸</div>
    <div class="nav-text">è®¾ç½®</div>
   </div> 
  </div> 

  <div class="status-toast" id="toast"></div> 

  <script>
        // é¢„è®¾é…ç½®
        const presets = {
            "normal": { outDelay: 0, inDelay: 0, outJitter: 0, inJitter: 0, outLoss: 0, inLoss: 0, outBandwidth: 0, inBandwidth: 0, outCycleType:"full",outCycleTime:0,outCycleLoss:0,inCycleType:"full",inCycleTime:0,inCycleLoss:0, name: "æ­£å¸¸ç½‘ç»œ", desc: "æœªè®¾ç½®ä»»ä½•å¼±ç½‘å‚æ•°çš„æ­£å¸¸ç½‘ç»œ" },
            "continuous_loss": { outDelay: 0, inDelay: 0, outJitter: 0, inJitter: 0, outLoss: 30, inLoss: 30, outBandwidth: 0, inBandwidth: 0, outCycleType:"full",outCycleTime:0,outCycleLoss:0,inCycleType:"full",inCycleTime:0,inCycleLoss:0, name: "è¿ç»­ä¸¢åŒ…", desc: "æ¨¡æ‹ŸçŸ­æ—¶é—´å†…è¿ç»­ä¸¢åŒ…çš„ç½‘ç»œåœºæ™¯" },
            "total_loss": { outDelay: 0, inDelay: 0, outJitter: 0, inJitter: 0, outLoss: 100, inLoss: 100, outBandwidth: 0, inBandwidth: 0, outCycleType:"full",outCycleTime:0,outCycleLoss:0,inCycleType:"full",inCycleTime:0,inCycleLoss:0, name: "100%ä¸¢åŒ…", desc: "ä¸Šä¸‹è¡Œ100%ä¸¢åŒ…çš„å¼±ç½‘åœºæ™¯" },
            "poor_network": { outDelay: 500, inDelay: 500, outJitter: 50, inJitter: 50, outLoss: 30, inLoss: 30, outBandwidth: 50, inBandwidth: 100, outCycleType:"full",outCycleTime:0,outCycleLoss:0,inCycleType:"full",inCycleTime:0,inCycleLoss:0, name: "æå·®ç½‘ç»œ", desc: "ä½å¸¦å®½ï¼Œé«˜å»¶è¿Ÿï¼Œé«˜æ¦‚ç‡éšæœºä¸¢åŒ…" },
            "4g": { outDelay: 50, inDelay: 50, outJitter: 10, inJitter: 10, outLoss: 0, inLoss: 0, outBandwidth: 5000, inBandwidth: 10000, outCycleType:"full",outCycleTime:0,outCycleLoss:0,inCycleType:"full",inCycleTime:0,inCycleLoss:0, name: "4Gç½‘ç»œ", desc: "æ¨¡æ‹Ÿ4Gç§»åŠ¨ç½‘ç»œç¯å¢ƒ" },
            "3g": { outDelay: 100, inDelay: 100, outJitter: 20, inJitter: 20, outLoss: 1, inLoss: 1, outBandwidth: 500, inBandwidth: 2000, outCycleType:"full",outCycleTime:0,outCycleLoss:0,inCycleType:"full",inCycleTime:0,inCycleLoss:0, name: "3Gç½‘ç»œ", desc: "æ¨¡æ‹Ÿ3Gç§»åŠ¨ç½‘ç»œç¯å¢ƒ" },
            "2g": { outDelay: 300, inDelay: 300, outJitter: 40, inJitter: 40, outLoss: 5, inLoss: 5, outBandwidth: 50, inBandwidth: 100, outCycleType:"full",outCycleTime:0,outCycleLoss:0,inCycleType:"full",inCycleTime:0,inCycleLoss:0, name: "2Gç½‘ç»œ", desc: "æ¨¡æ‹Ÿ2Gç§»åŠ¨ç½‘ç»œç¯å¢ƒ" }
        };

        // å…¨å±€å˜é‡åˆå§‹åŒ–
        let isRunning = false;
        let selectedScene = "normal";
        let currentConfigScene = "normal";
        let driverTestLogs = [];
        let driverReady = false;
        
        // DOM å…ƒç´ å¼•ç”¨
        const btnStart = document.getElementById('btnStart');
        const driverLogBox = document.getElementById('driverLogBox');
        const driverStatusText = document.getElementById('driverStatusText');

        // ========== åˆå§‹åŒ– ==========
        window.onload = function() {
            // åˆå§‹åŒ–é¡µé¢çŠ¶æ€
            updateBtnStatus();
            loadOptions();
            autoCheckDriver();
            // è·å–pcapè·¯å¾„
            setTimeout(() => {
                if (document.getElementById('dumpPcap').checked) {
                    callNative({ api: "pcap_path" });
                }
            }, 500);
        };

        // ========== é©±åŠ¨æµ‹è¯•ç›¸å…³å‡½æ•° ==========
        function autoCheckDriver() {
            addDriverLog('ç³»ç»Ÿ', 'è‡ªåŠ¨æ£€æµ‹é©±åŠ¨çŠ¶æ€...');
            callNative({ 
                api: "check_driver_status",
                timestamp: Date.now()
            });
            
            // æ¨¡æ‹Ÿå›è°ƒï¼ˆå®é™…åº”ç”±Nativeå›è°ƒï¼‰
            setTimeout(() => {
                if (window.qnetAndroidObj && window.qnetAndroidObj.callAndroidApi) {
                    // çœŸå®ç¯å¢ƒä¸‹ï¼Œè¿™é‡Œä¼šè¢«Nativeå›è°ƒè¦†ç›–
                } else {
                    // å¼€å‘ç¯å¢ƒæ¨¡æ‹Ÿ
                    driverReady = false;
                    driverStatusText.innerHTML = 'é©±åŠ¨æœªå®‰è£… <span style="font-size: 12px; color: #a0aec0; margin-left: 8px;">(æ¨¡æ‹Ÿç¯å¢ƒ)</span>';
                    driverStatusText.className = 'driver-status-value unready';
                    addDriverLog('ç³»ç»Ÿ', 'é©±åŠ¨çŠ¶æ€æ£€æµ‹å®Œæˆï¼šæœªå®‰è£… (å½“å‰ä¸ºæ¨¡æ‹Ÿç¯å¢ƒ)', 'error');
                    updateDriverVersion('æœªå®‰è£…');
                }
            }, 800);
        }

        function testDriver() {
            addDriverLog('ç”¨æˆ·', 'å¼€å§‹æµ‹è¯•é©±åŠ¨...');
            driverStatusText.innerHTML = 'æµ‹è¯•ä¸­...';
            driverStatusText.className = 'driver-status-value';
            
            callNative({
                api: "test_driver",
                action: "full_test",
                timestamp: Date.now()
            });

            // æ¨¡æ‹Ÿæµ‹è¯•è¿‡ç¨‹
            addDriverLog('é©±åŠ¨', 'æ­£åœ¨æ£€æµ‹VPN Service...');
            addDriverLog('é©±åŠ¨', 'æ­£åœ¨æ£€æµ‹ç½‘ç»œæ ˆ...');
            addDriverLog('é©±åŠ¨', 'æ­£åœ¨æ£€æµ‹å†…æ ¸æ¨¡å—...');
            
            setTimeout(() => {
                if (window.qnetAndroidObj && window.qnetAndroidObj.callAndroidApi) {
                    // çœŸå®ç¯å¢ƒç­‰å¾…å›è°ƒ
                } else {
                    // æ¨¡æ‹Ÿç¯å¢ƒ
                    const success = Math.random() > 0.3;
                    if (success) {
                        driverReady = true;
                        driverStatusText.innerHTML = 'é©±åŠ¨å°±ç»ª (æ¨¡æ‹Ÿç¯å¢ƒ)';
                        driverStatusText.className = 'driver-status-value ready';
                        addDriverLog('é©±åŠ¨', 'âœ… é©±åŠ¨æµ‹è¯•é€šè¿‡', 'success');
                        addDriverLog('é©±åŠ¨', 'VPN ServiceçŠ¶æ€: æ­£å¸¸', 'success');
                        addDriverLog('é©±åŠ¨', 'ç½‘ç»œæ ˆçŠ¶æ€: æ­£å¸¸', 'success');
                        addDriverLog('é©±åŠ¨', 'å†…æ ¸æ¨¡å—: å·²åŠ è½½', 'success');
                        updateDriverVersion('v2.1.5');
                        showToast('é©±åŠ¨æµ‹è¯•å®Œæˆ');
                    } else {
                        driverReady = false;
                        driverStatusText.innerHTML = 'é©±åŠ¨å¼‚å¸¸ (æ¨¡æ‹Ÿç¯å¢ƒ)';
                        driverStatusText.className = 'driver-status-value unready';
                        addDriverLog('é©±åŠ¨', 'âŒ é©±åŠ¨æµ‹è¯•å¤±è´¥', 'error');
                        addDriverLog('é©±åŠ¨', 'VPN ServiceçŠ¶æ€: å¼‚å¸¸', 'error');
                        addDriverLog('é©±åŠ¨', 'å»ºè®®é‡æ–°å®‰è£…é©±åŠ¨', 'error');
                        showToast('é©±åŠ¨æµ‹è¯•å¤±è´¥');
                    }
                }
            }, 1500);
        }

        function installDriver() {
            addDriverLog('ç”¨æˆ·', 'å¼€å§‹å®‰è£…é©±åŠ¨...');
            showToast('æ­£åœ¨å®‰è£…é©±åŠ¨...');
            
            callNative({
                api: "install_driver",
                version: "2.1.5",
                timestamp: Date.now()
            });

            setTimeout(() => {
                if (window.qnetAndroidObj && window.qnetAndroidObj.callAndroidApi) {
                    // çœŸå®ç¯å¢ƒç­‰å¾…å›è°ƒ
                } else {
                    // æ¨¡æ‹Ÿç¯å¢ƒ
                    addDriverLog('é©±åŠ¨', 'æ­£åœ¨è¯·æ±‚å®‰è£…æƒé™...');
                    addDriverLog('é©±åŠ¨', 'æ­£åœ¨ä¸‹è½½é©±åŠ¨ç»„ä»¶...');
                    addDriverLog('é©±åŠ¨', 'æ­£åœ¨å®‰è£…VPNæœåŠ¡...');
                    
                    setTimeout(() => {
                        driverReady = true;
                        driverStatusText.innerHTML = 'é©±åŠ¨å·²å®‰è£… (æ¨¡æ‹Ÿç¯å¢ƒ)';
                        driverStatusText.className = 'driver-status-value ready';
                        addDriverLog('é©±åŠ¨', 'âœ… é©±åŠ¨å®‰è£…æˆåŠŸ', 'success');
                        addDriverLog('é©±åŠ¨', 'ç‰ˆæœ¬: v2.1.5', 'success');
                        addDriverLog('é©±åŠ¨', 'è¯·å¯åŠ¨å¼±ç½‘æœåŠ¡', 'success');
                        updateDriverVersion('v2.1.5');
                        showToast('é©±åŠ¨å®‰è£…å®Œæˆ');
                    }, 2000);
                }
            }, 500);
        }

        function checkVpnPermission() {
            addDriverLog('ç”¨æˆ·', 'æ£€æµ‹VPNæƒé™...');
            callNative({ api: "check_vpn_permission" });
            
            setTimeout(() => {
                addDriverLog('VPN', 'VPNæƒé™çŠ¶æ€: å·²æˆäºˆ', 'success');
                addDriverLog('VPN', 'ä»£ç†ç«¯å£: 1080', 'success');
                showToast('VPNæƒé™æ­£å¸¸');
            }, 600);
        }

        function checkNetworkStack() {
            addDriverLog('ç”¨æˆ·', 'æ£€æµ‹ç½‘ç»œæ ˆ...');
            callNative({ api: "check_network_stack" });
            
            setTimeout(() => {
                addDriverLog('ç½‘ç»œæ ˆ', 'TCPæ ˆ: æ­£å¸¸', 'success');
                addDriverLog('ç½‘ç»œæ ˆ', 'UDPæ ˆ: æ­£å¸¸', 'success');
                addDriverLog('ç½‘ç»œæ ˆ', 'ICMPæ ˆ: æ­£å¸¸', 'success');
                showToast('ç½‘ç»œæ ˆæ£€æµ‹å®Œæˆ');
            }, 600);
        }

        function checkDriverUpdate() {
            addDriverLog('ç”¨æˆ·', 'æ£€æŸ¥é©±åŠ¨æ›´æ–°...');
            callNative({ api: "check_driver_update" });
            
            setTimeout(() => {
                addDriverLog('æ›´æ–°', 'å½“å‰ç‰ˆæœ¬: v2.1.5', 'success');
                addDriverLog('æ›´æ–°', 'å·²æ˜¯æœ€æ–°ç‰ˆæœ¬', 'success');
                showToast('å·²æ˜¯æœ€æ–°ç‰ˆæœ¬');
            }, 800);
        }

        function clearDriverLog() {
            driverTestLogs = [];
            driverLogBox.innerHTML = '<div class="driver-log-item">æ—¥å¿—å·²æ¸…ç©º</div>';
            addDriverLog('ç³»ç»Ÿ', 'æ—¥å¿—å·²æ¸…ç©º');
        }

        function addDriverLog(source, message, type = '') {
            const logItem = document.createElement('div');
            logItem.className = `driver-log-item ${type}`;
            const timestamp = new Date().toLocaleTimeString('en-US', { hour12: false });
            logItem.textContent = `[${timestamp}] [${source}] ${message}`;
            driverLogBox.appendChild(logItem);
            driverLogBox.scrollTop = driverLogBox.scrollHeight;
            driverTestLogs.push({ source, message, type, timestamp });
        }

        function updateDriverVersion(version) {
            const driverVersionEl = document.getElementById('driverVersion');
            if (driverVersionEl) {
                driverVersionEl.textContent = version + (driverReady ? ' (å·²åŠ è½½)' : ' (æœªåŠ è½½)');
            }
        }

        // ========== Nativeå›è°ƒå¤„ç†ï¼ˆä¾›Androidè°ƒç”¨ï¼‰==========
        window.handleNativeCallback = function(response) {
            try {
                const data = typeof response === 'string' ? JSON.parse(response) : response;
                console.log('Nativeå›è°ƒ:', data);
                
                switch(data.api) {
                    case 'check_driver_status':
                        driverReady = data.status === 'ready';
                        driverStatusText.innerHTML = driverReady ? 'é©±åŠ¨å°±ç»ª' : 'é©±åŠ¨æœªå®‰è£…';
                        driverStatusText.className = driverReady ? 'driver-status-value ready' : 'driver-status-value unready';
                        addDriverLog('ç³»ç»Ÿ', `é©±åŠ¨çŠ¶æ€: ${driverReady ? 'å°±ç»ª' : 'æœªå®‰è£…'}`, driverReady ? 'success' : 'error');
                        updateDriverVersion(data.version || 'v2.1.5');
                        break;
                        
                    case 'test_driver':
                        driverReady = data.success === true;
                        driverStatusText.innerHTML = driverReady ? 'é©±åŠ¨å°±ç»ª' : 'é©±åŠ¨å¼‚å¸¸';
                        driverStatusText.className = driverReady ? 'driver-status-value ready' : 'driver-status-value unready';
                        addDriverLog('é©±åŠ¨', data.message || (driverReady ? 'é©±åŠ¨æµ‹è¯•é€šè¿‡' : 'é©±åŠ¨æµ‹è¯•å¤±è´¥'), driverReady ? 'success' : 'error');
                        break;
                        
                    case 'install_driver':
                        if (data.success) {
                            driverReady = true;
                            driverStatusText.innerHTML = 'é©±åŠ¨å·²å®‰è£…';
                            driverStatusText.className = 'driver-status-value ready';
                            updateDriverVersion(data.version || 'v2.1.5');
                        }
                        addDriverLog('é©±åŠ¨', data.message || (data.success ? 'å®‰è£…æˆåŠŸ' : 'å®‰è£…å¤±è´¥'), data.success ? 'success' : 'error');
                        break;
                        
                    case 'toggle_vpn':
                        isRunning = data.status === 'running';
                        updateBtnStatus();
                        showToast(data.message || (isRunning ? 'å·²å¯åŠ¨' : 'å·²åœæ­¢'));
                        break;
                        
                    case 'pcap_path':
                        document.getElementById('pcapPath').textContent = data.path || 'ä¿å­˜è·¯å¾„è·å–å¤±è´¥';
                        document.getElementById('pcapPathSection').style.display = 'block';
                        break;
                        
                    case 'check_vpn_permission':
                        addDriverLog('VPN', data.message || 'VPNæƒé™çŠ¶æ€: ' + (data.granted ? 'å·²æˆäºˆ' : 'æœªæˆäºˆ'), data.granted ? 'success' : 'error');
                        break;
                }
            } catch(e) {
                console.error('å›è°ƒå¤„ç†å¤±è´¥:', e);
            }
        };

        // ========== é¡µé¢åˆ‡æ¢å‡½æ•° ==========
        function switchPage(targetPage) {
            const pageMap = {
                workbench: 'pageWorkbench',
                config: 'pageConfig',
                settings: 'pageSettings'
            };
            const navMap = {
                workbench: 'navWorkbench',
                config: 'navConfig',
                settings: 'navSettings'
            };
            const titleMap = {
                workbench: 'è½ç¾½SVIPå¼±ç½‘',
                config: 'å‚æ•°é…ç½®',
                settings: 'è®¾ç½®'
            };

            const targetPageId = pageMap[targetPage];
            const currentActive = document.querySelector('.page.active');
            if (currentActive && currentActive.id === targetPageId) return;

            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(targetPageId).classList.add('active');

            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.getElementById(navMap[targetPage]).classList.add('active');

            document.getElementById('pageTitle').textContent = titleMap[targetPage];
        }

        // ========== åœºæ™¯é…ç½®ç›¸å…³å‡½æ•° ==========
        function gotoConfigPageByNav() {
            const activeScene = document.querySelector('.scene-item.selected');
            if (activeScene) {
                currentConfigScene = activeScene.dataset.scene;
                selectedScene = currentConfigScene;
                loadSceneConfig(selectedScene);
                switchPage('config');
            } else {
                loadSceneConfig('normal');
                switchPage('config');
            }
        }

        function gotoConfigPage(el) {
            currentConfigScene = el.dataset.scene;
            selectedScene = currentConfigScene;
            document.querySelectorAll('.scene-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected');
            loadSceneConfig(selectedScene);
            switchPage('config');
        }

        function loadSceneConfig(scene) {
            const config = presets[scene] || presets.normal;
            document.getElementById('configSceneName').textContent = config.name;
            document.getElementById('configSceneDesc').textContent = config.desc;
            document.getElementById('outDelay').value = config.outDelay;
            document.getElementById('inDelay').value = config.inDelay;
            document.getElementById('outJitter').value = config.outJitter;
            document.getElementById('inJitter').value = config.inJitter;
            document.getElementById('outLoss').value = config.outLoss;
            document.getElementById('inLoss').value = config.inLoss;
            document.getElementById('outBandwidth').value = config.outBandwidth;
            document.getElementById('inBandwidth').value = config.inBandwidth;
            document.getElementById('outCycleType').value = config.outCycleType;
            document.getElementById('outCycleTime').value = config.outCycleTime;
            document.getElementById('outCycleLoss').value = config.outCycleLoss;
            document.getElementById('inCycleType').value = config.inCycleType;
            document.getElementById('inCycleTime').value = config.inCycleTime;
            document.getElementById('inCycleLoss').value = config.inCycleLoss;
        }

        function confirmConfig() {
            showToast('é…ç½®å·²ä¿å­˜');
            switchPage('workbench');
        }

        function resetConfig() {
            loadSceneConfig(selectedScene);
            showToast('å·²é‡ç½®ä¸ºé»˜è®¤å‚æ•°');
        }

        // ========== æŒ‰é’®çŠ¶æ€æ›´æ–° ==========
        function updateBtnStatus() {
            if (isRunning) {
                btnStart.textContent = 'åœæ­¢';
                btnStart.classList.add('running');
            } else {
                btnStart.textContent = 'å¯åŠ¨';
                btnStart.classList.remove('running');
            }
        }

        // ========== é…ç½®è·å–ä¸ä¿å­˜ ==========
        function getConfig() {
            return {
                api: "start_qnet",
                dump_pcap: document.getElementById('dumpPcap').checked ? 1 : 0,
                control_fw: document.getElementById('controlFw').checked ? 1 : 0,
                info_fw: document.getElementById('infoFw').checked ? 1 : 0,
                anti_block: document.getElementById('antiBlock').checked ? 1 : 0,
                profile: {
                    profile_id: "local_" + Date.now(),
                    name: presets[selectedScene].name,
                    desc: "Local config",
                    type: 2,
                    params: [{
                        duration: -1,
                        out_delay: parseInt(document.getElementById('outDelay').value) || 0,
                        in_delay: parseInt(document.getElementById('inDelay').value) || 0,
                        out_jitter: parseInt(document.getElementById('outJitter').value) || 0,
                        in_jitter: parseInt(document.getElementById('inJitter').value) || 0,
                        out_loss: parseInt(document.getElementById('outLoss').value) || 0,
                        in_loss: parseInt(document.getElementById('inLoss').value) || 0,
                        out_bandwidth: parseInt(document.getElementById('outBandwidth').value) || -1,
                        in_bandwidth: parseInt(document.getElementById('inBandwidth').value) || -1,
                        protocol: parseInt(document.getElementById('protocolType').value) || 3,
                        out_cycle_type: document.getElementById('outCycleType').value,
                        out_cycle_time: parseInt(document.getElementById('outCycleTime').value) || 0,
                        out_cycle_loss: parseInt(document.getElementById('outCycleLoss').value) || 0,
                        in_cycle_type: document.getElementById('inCycleType').value,
                        in_cycle_time: parseInt(document.getElementById('inCycleTime').value) || 0,
                        in_cycle_loss: parseInt(document.getElementById('inCycleLoss').value) || 0
                    }]
                }
            };
        }

        function loadOptions() {
            // ä»NativeåŠ è½½é…ç½®
            callNative({ api: "get_qnet_options" });
        }

        function saveOptions() {
            callNative({ 
                api: "set_qnet_option", 
                control_fw: document.getElementById('controlFw').checked ? 1 : 0, 
                info_fw: document.getElementById('infoFw').checked ? 1 : 0, 
                dump_pcap: document.getElementById('dumpPcap').checked ? 1 : 0,
                anti_block: document.getElementById('antiBlock').checked ? 1 : 0 
            });
            
            const pcapPathSection = document.getElementById('pcapPathSection');
            pcapPathSection.style.display = document.getElementById('dumpPcap').checked ? 'block' : 'none';
            
            if (document.getElementById('dumpPcap').checked) {
                callNative({ api: "pcap_path" });
            }
        }

        // ========== å·¥å…·å‡½æ•° ==========
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        // ========== Nativeäº¤äº’å‡½æ•° ==========
        function callNative(data) {
            if (window.qnetAndroidObj && window.qnetAndroidObj.callAndroidApi) {
                window.qnetAndroidObj.callAndroidApi(JSON.stringify(data));
                console.log('è°ƒç”¨Native:', data);
            } else {
                console.log('Nativeæ¥å£ä¸å­˜åœ¨ï¼Œæ¨¡æ‹Ÿè°ƒç”¨:', data);
                // æ¨¡æ‹Ÿå›è°ƒ
                setTimeout(() => {
                    if (data.api === 'check_driver_status') {
                        window.handleNativeCallback({
                            api: 'check_driver_status',
                            status: 'not_ready',
                            version: 'v2.1.5'
                        });
                    }
                }, 100);
            }
        }

        function toggleVPN() { 
            if (!driverReady && !window.qnetAndroidObj) {
                showToast('è¯·å…ˆæµ‹è¯•å¹¶å®‰è£…é©±åŠ¨');
                addDriverLog('ç³»ç»Ÿ', 'âŒ é©±åŠ¨æœªå°±ç»ªï¼Œæ— æ³•å¯åŠ¨', 'error');
                return;
            }
            
            if (isRunning) {
                callNative({ api: "stop_qnet" }); 
            } else {
                callNative(getConfig());
            }
            isRunning = !isRunning;
            updateBtnStatus();
        }

        function goBack() { 
            callNative({ api: "click_back_button" }); 
        }
  </script>
 </body> 
</html>